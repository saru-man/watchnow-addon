!function(h,v){"object"==typeof exports&&"object"==typeof module?module.exports=v(require("ionic.angular"),require("ng.common"),require("ng.core"),require("ng.forms"),require("ngx-translate.core"),require("rxjs"),require("tslib"),require("wako-app.mobile-sdk")):"function"==typeof define&&define.amd?define(["ionic.angular","ng.common","ng.core","ng.forms","ngx-translate.core","rxjs","tslib","wako-app.mobile-sdk"],v):"object"==typeof exports?exports.plugin=v(require("ionic.angular"),require("ng.common"),require("ng.core"),require("ng.forms"),require("ngx-translate.core"),require("rxjs"),require("tslib"),require("wako-app.mobile-sdk")):h.plugin=v(h["ionic.angular"],h["ng.common"],h["ng.core"],h["ng.forms"],h["ngx-translate.core"],h.rxjs,h.tslib,h["wako-app.mobile-sdk"])}(typeof self<"u"?self:this,(z,h,v,ae,le,ue,de,pe)=>(()=>{"use strict";var fe={372:a=>{a.exports=z},223:a=>{a.exports=h},888:a=>{a.exports=v},951:a=>{a.exports=ae},584:a=>{a.exports=le},832:a=>{a.exports=ue},748:a=>{a.exports=de},95:a=>{a.exports=pe}},L={};function u(a){var m=L[a];if(void 0!==m)return m.exports;var f=L[a]={exports:{}};return fe[a](f,f.exports,u),f.exports}u.d=(a,m)=>{for(var f in m)u.o(m,f)&&!u.o(a,f)&&Object.defineProperty(a,f,{enumerable:!0,get:m[f]})},u.o=(a,m)=>Object.prototype.hasOwnProperty.call(a,m),u.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var I={};return(()=>{u.r(I),u.d(I,{PluginModule:()=>ie,default:()=>Xe});var a=u(223),m=u(951),f=u(372),F=u(584),b=u(95),i=u(888);function d(e){return"function"==typeof e}function E(e){return n=>{if(function he(e){return d(e?.lift)}(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function B(...e){(0,b.wakoLog)("plugin.watchnow",e)}var x=u(748);const O=function ye(e){const t=e(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function H(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class g{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(d(r))try{r()}catch(s){n=s instanceof O?s.errors:[s]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const s of o)try{N(s)}catch(c){n=n??[],c instanceof O?n=[...n,...c.errors]:n.push(c)}}if(n)throw new O(n)}}add(n){var t;if(n&&n!==this)if(this.closed)N(n);else{if(n instanceof g){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&H(t,n)}remove(n){const{_finalizers:t}=this;t&&H(t,n),n instanceof g&&n._removeParent(this)}}function G(e){return e instanceof g||e&&"closed"in e&&d(e.remove)&&d(e.add)&&d(e.unsubscribe)}function N(e){d(e)?e():e.unsubscribe()}g.EMPTY=(()=>{const e=new g;return e.closed=!0,e})();const y={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},M={setTimeout(e,n,...t){const{delegate:r}=M;return r?.setTimeout?r.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=M;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Y(e){M.setTimeout(()=>{const{onUnhandledError:n}=y;if(!n)throw e;n(e)})}function W(){}const we=A("C",void 0,void 0);function A(e,n,t){return{kind:e,value:n,error:t}}let w=null;class q extends g{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,G(n)&&n.add(this)):this.destination=ke}static create(n,t,r){return new j(n,t,r)}next(n){this.isStopped?D(function xe(e){return A("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?D(function ve(e){return A("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?D(we,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Me=Function.prototype.bind;function U(e,n){return Me.call(e,n)}class Pe{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(r){P(r)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(r){P(r)}else P(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){P(t)}}}class j extends q{constructor(n,t,r){let o;if(super(),d(n)||!n)o={next:n??void 0,error:t??void 0,complete:r??void 0};else{let s;this&&y.useDeprecatedNextContext?(s=Object.create(n),s.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&U(n.next,s),error:n.error&&U(n.error,s),complete:n.complete&&U(n.complete,s)}):o=n}this.destination=new Pe(o)}}function P(e){y.useDeprecatedSynchronousErrorHandling?function Ee(e){y.useDeprecatedSynchronousErrorHandling&&w&&(w.errorThrown=!0,w.error=e)}(e):Y(e)}function D(e,n){const{onStoppedNotification:t}=y;t&&M.setTimeout(()=>t(e,n))}const ke={closed:!0,next:W,error:function Ce(e){throw e},complete:W},R="function"==typeof Symbol&&Symbol.observable||"@@observable";function Te(e){return e}let S=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new e;return r.source=this,r.operator=t,r}subscribe(t,r,o){const s=function Fe(e){return e&&e instanceof q||function Ie(e){return e&&d(e.next)&&d(e.error)&&d(e.complete)}(e)&&G(e)}(t)?t:new j(t,r,o);return function Se(e){if(y.useDeprecatedSynchronousErrorHandling){const n=!w;if(n&&(w={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:r}=w;if(w=null,t)throw r}}else e()}(()=>{const{operator:c,source:l}=this;s.add(c?c.call(s,l):l?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=K(r))((o,s)=>{const c=new j({next:l=>{try{t(l)}catch(p){s(p),c.unsubscribe()}},error:s,complete:o});this.subscribe(c)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[R](){return this}pipe(...t){return function V(e){return 0===e.length?Te:1===e.length?e[0]:function(t){return e.reduce((r,o)=>o(r),t)}}(t)(this)}toPromise(t){return new(t=K(t))((r,o)=>{let s;this.subscribe(c=>s=c,c=>o(c),()=>r(s))})}}return e.create=n=>new e(n),e})();function K(e){var n;return null!==(n=e??y.Promise)&&void 0!==n?n:Promise}const Ue=function qe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function J(e){if(e instanceof S)return e;if(null!=e){if(function Be(e){return d(e[R])}(e))return function $e(e){return new S(n=>{const t=e[R]();if(d(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if((e=>e&&"number"==typeof e.length&&"function"!=typeof e)(e))return function ze(e){return new S(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(function ge(e){return d(e?.then)}(e))return function Le(e){return new S(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,Y)})}(e);if(function Oe(e){return Symbol.asyncIterator&&d(e?.[Symbol.asyncIterator])}(e))return Q(e);if(function je(e){return d(e?.[Ue])}(e))return function He(e){return new S(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(function Re(e){return d(e?.getReader)}(e))return function Ge(e){return Q(function De(e){return(0,x.__asyncGenerator)(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:r,done:o}=yield(0,x.__await)(t.read());if(o)return yield(0,x.__await)(void 0);yield yield(0,x.__await)(r)}}finally{t.releaseLock()}})}(e))}(e)}throw function Ae(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}(e)}function Q(e){return new S(n=>{(function Ne(e,n){var t,r,o,s;return(0,x.__awaiter)(this,void 0,void 0,function*(){try{for(t=(0,x.__asyncValues)(e);!(r=yield t.next()).done;)if(n.next(r.value),n.closed)return}catch(c){o={error:c}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(o)throw o.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function C(e,n,t,r,o){return new Ye(e,n,t,r,o)}class Ye extends q{constructor(n,t,r,o,s,c){super(n),this.onFinalize=s,this.shouldUnsubscribe=c,this._next=t?function(l){try{t(l)}catch(p){n.error(p)}}:super._next,this._error=o?function(l){try{o(l)}catch(p){n.error(p)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(l){n.error(l)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function X(e){return E((n,t)=>{let s,r=null,o=!1;r=n.subscribe(C(t,void 0,void 0,c=>{s=J(e(c,X(e)(n))),r?(r.unsubscribe(),r=null,s.subscribe(t)):o=!0})),o&&(r.unsubscribe(),r=null,s.subscribe(t))})}function $(e,n){return E((t,r)=>{let o=0;t.subscribe(C(r,s=>{r.next(e.call(n,s,o++))}))})}var k=u(832);let Z=(()=>{class e{getNameFromId(t){switch(t){case"apple_itunes":return"Itunes";case"google_play_movies":return"Google Play";case"netflix":return"Netflix";default:return t.replace(/_/gi," ")}}getNetflixUrl(t){return b.WakoHttpRequestService.get(t.url,null,"3d").pipe(X(r=>302===r.status?(0,k.of)(r.response):(0,k.throwError)(r)),$(r=>{if(r.match("Found")&&null!==r.match(/href="([^"]*)/)){const l=r.match(/href="([^"]*)/);if(l[1])return l[1]}const c=(new DOMParser).parseFromString(r,"text/html").querySelector('meta[property="al:ios:url"]');return c&&c.getAttribute("content")?`http://www.netflix.com/watch/${c.getAttribute("content").split("/").pop().split("?").shift()}`:t.url}))}setKnownPlatformUrl(t){const r=[];return t.forEach(o=>{r.push("netflix"===o.id?this.getNetflixUrl(t[0]).pipe($(s=>(o.url=s,o))):(0,k.of)(o))}),(0,k.forkJoin)(r)}getSources(t){let r=null;return t.movie?r=`/movies/${t.movie.ids.trakt}`:t.show&&t.episode&&(r=`/shows/${t.show.ids.trakt}/seasons/${t.episode.seasonNumber}/episodes/${t.episode.number}`),b.WakoHttpRequestService.get("https://trakt.tv"+r,null,"3d").pipe($(o=>{const s=[];try{(new DOMParser).parseFromString(o,"text/html").querySelectorAll(".sources a").forEach(_=>{s.push({id:_.getAttribute("data-source").trim(),name:this.getNameFromId(_.getAttribute("data-source").trim()),country:_.getAttribute("data-country").trim(),url:"https://trakt.tv"+_.getAttribute("link").trim(),logoUrl:"https://trakt.tv"+_.querySelector("img").getAttribute("data-original")})})}catch{}return s}),function We(e,n){return E((t,r)=>{let o=null,s=0,c=!1;const l=()=>c&&!o&&r.complete();t.subscribe(C(r,p=>{o?.unsubscribe();let _=0;const se=s++;J(e(p,se)).subscribe(o=C(r,ce=>r.next(n?n(p,ce,se,_++):ce),()=>{o=null,l()}))},()=>{c=!0,l()}))})}(o=>this.setKnownPlatformUrl(o)))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=i.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e})();function Ve(e,n){1&e&&i.\u0275\u0275element(0,"ion-spinner")}function Ke(e,n){1&e&&(i.\u0275\u0275elementStart(0,"ion-text"),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),2&e&&(i.\u0275\u0275advance(1),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,1,"noSourceFound")))}function Je(e,n){if(1&e){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"ion-button",3),i.\u0275\u0275listener("click",function(){const s=i.\u0275\u0275restoreView(t).$implicit,c=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(c.goTo(s))}),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"titlecase"),i.\u0275\u0275elementEnd()}if(2&e){const t=n.$implicit;i.\u0275\u0275classMap(t.id),i.\u0275\u0275advance(1),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,4,t.name)," ")}}let T=(()=>{class e{constructor(t){this.watchnowService=t,this.type="button",this.sources=[],this.loading=!0}ngOnInit(){this.watchnowService.getSources({movie:this.movie,show:this.show,episode:this.episode}).pipe(function me(e){return E((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}(()=>this.loading=!1)).subscribe(t=>{this.sources=t,console.log({sources:t})})}goTo(t){(function be(e,n){"FirebasePlugin"in window&&window.FirebasePlugin.logEvent(e,n)})("addon_watchnow",{type:this.type,source:t.id}),b.BrowserService.open(t.url,!1)}}return e.\u0275fac=function(t){return new(t||e)(i.\u0275\u0275directiveInject(Z))},e.\u0275cmp=i.\u0275\u0275defineComponent({type:e,selectors:[["wk-open-button"]],inputs:{movie:"movie",show:"show",episode:"episode",type:"type"},decls:4,vars:3,consts:[[1,"container"],[4,"ngIf"],["expand","block",3,"class","click",4,"ngFor","ngForOf"],["expand","block",3,"click"]],template:function(t,r){1&t&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275template(1,Ve,1,0,"ion-spinner",1),i.\u0275\u0275template(2,Ke,3,3,"ion-text",1),i.\u0275\u0275template(3,Je,3,6,"ion-button",2),i.\u0275\u0275elementEnd()),2&t&&(i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",r.loading),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",!r.loading&&0===r.sources.length),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngForOf",r.sources))},dependencies:[a.NgForOf,a.NgIf,f.IonButton,f.IonSpinner,f.IonText,a.TitleCasePipe,F.TranslatePipe],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.container[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]   .button.netflix[_ngcontent-%COMP%]{--background: #e50914}.container[_ngcontent-%COMP%]   .button.apple_itunes[_ngcontent-%COMP%]{--background: #999}.container[_ngcontent-%COMP%]   .button.google_play_movies[_ngcontent-%COMP%]{--background: #607d8b}"]}),e})(),ee=(()=>{class e extends b.EpisodeDetailBaseComponent{setShowEpisode(t,r){this.show=t,this.episode=r}}return e.\u0275fac=function(){let n;return function(r){return(n||(n=i.\u0275\u0275getInheritedFactory(e)))(r||e)}}(),e.\u0275cmp=i.\u0275\u0275defineComponent({type:e,selectors:[["ng-component"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:1,vars:2,consts:[[3,"show","episode"]],template:function(t,r){1&t&&i.\u0275\u0275element(0,"wk-open-button",0),2&t&&i.\u0275\u0275property("show",r.show)("episode",r.episode)},dependencies:[T]}),e})(),te=(()=>{class e extends b.MovieDetailBaseComponent{setMovie(t){this.movie=t}}return e.\u0275fac=function(){let n;return function(r){return(n||(n=i.\u0275\u0275getInheritedFactory(e)))(r||e)}}(),e.\u0275cmp=i.\u0275\u0275defineComponent({type:e,selectors:[["ng-component"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"movie"]],template:function(t,r){1&t&&i.\u0275\u0275element(0,"wk-open-button",0),2&t&&i.\u0275\u0275property("movie",r.movie)},dependencies:[T]}),e})();function ne(e,n,t,r,o,s,c){try{var l=e[s](c),p=l.value}catch(_){return void t(_)}l.done?n(p):Promise.resolve(p).then(r,o)}let re=(()=>{class e extends b.PluginBaseService{constructor(t){super(),this.translate=t}initialize(){B("plugin initialized")}afterInstall(){B("plugin installed")}afterUpdate(){B("plugin updated")}setTranslation(t,r){this.translate.setDefaultLang(t),this.translate.use(t),this.translate.setTranslation(t,r)}customAction(t,r){}beforeMovieMiddleware(t){throw new Error("Method not implemented.")}afterMovieMiddleware(t){throw new Error("Method not implemented.")}beforeShowMiddleware(t){throw new Error("Method not implemented.")}afterShowMiddleware(t){throw new Error("Method not implemented.")}beforeEpisodeMiddleware(t,r){throw new Error("Method not implemented.")}afterEpisodeMiddleware(t,r){throw new Error("Method not implemented.")}fetchExplorerFolderItem(){throw new Error("Method not implemented.")}getFileActionButtons(t,r,o,s,c,l){return function Qe(e){return function(){var n=this,t=arguments;return new Promise(function(r,o){var s=e.apply(n,t);function c(p){ne(s,r,o,c,l,"next",p)}function l(p){ne(s,r,o,c,l,"throw",p)}c(void 0)})}}(function*(){throw new Error("Method not implemented.")})()}}return e.\u0275fac=function(t){return new(t||e)(i.\u0275\u0275inject(F.TranslateService))},e.\u0275prov=i.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e})(),oe=(()=>{class e extends b.ShowDetailBaseComponent{setShow(t){this.show=t}}return e.\u0275fac=function(){let n;return function(r){return(n||(n=i.\u0275\u0275getInheritedFactory(e)))(r||e)}}(),e.\u0275cmp=i.\u0275\u0275defineComponent({type:e,selectors:[["ng-component"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"show"]],template:function(t,r){1&t&&i.\u0275\u0275element(0,"wk-open-button",0),2&t&&i.\u0275\u0275property("show",r.show)},dependencies:[T]}),e})(),ie=(()=>{class e extends b.PluginBaseModule{}return e.pluginService=re,e.movieComponent=te,e.episodeComponent=ee,e.showComponent=oe,e.\u0275fac=function(){let n;return function(r){return(n||(n=i.\u0275\u0275getInheritedFactory(e)))(r||e)}}(),e.\u0275mod=i.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=i.\u0275\u0275defineInjector({providers:[re,Z],imports:[a.CommonModule,m.FormsModule,f.IonicModule.forRoot(),F.TranslateModule.forRoot()]}),e})();const Xe=ie})(),I})());