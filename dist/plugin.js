!function(m,T){"object"==typeof exports&&"object"==typeof module?module.exports=T(require("ionic.angular"),require("ng.common"),require("ng.core"),require("ng.forms"),require("ngx-translate.core"),require("rxjs"),require("tslib"),require("wako-app.mobile-sdk")):"function"==typeof define&&define.amd?define(["ionic.angular","ng.common","ng.core","ng.forms","ngx-translate.core","rxjs","tslib","wako-app.mobile-sdk"],T):"object"==typeof exports?exports.plugin=T(require("ionic.angular"),require("ng.common"),require("ng.core"),require("ng.forms"),require("ngx-translate.core"),require("rxjs"),require("tslib"),require("wako-app.mobile-sdk")):m.plugin=T(m["ionic.angular"],m["ng.common"],m["ng.core"],m["ng.forms"],m["ngx-translate.core"],m.rxjs,m.tslib,m["wako-app.mobile-sdk"])}(typeof self<"u"?self:this,(V,m,T,ae,le,ue,de,pe)=>(()=>{"use strict";var fe={372:a=>{a.exports=V},223:a=>{a.exports=m},888:a=>{a.exports=T},951:a=>{a.exports=ae},584:a=>{a.exports=le},832:a=>{a.exports=ue},748:a=>{a.exports=de},95:a=>{a.exports=pe}},W={};function d(a){var b=W[a];if(void 0!==b)return b.exports;var f=W[a]={exports:{}};return fe[a](f,f.exports,d),f.exports}d.d=(a,b)=>{for(var f in b)d.o(b,f)&&!d.o(a,f)&&Object.defineProperty(a,f,{enumerable:!0,get:b[f]})},d.o=(a,b)=>Object.prototype.hasOwnProperty.call(a,b),d.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var q={};return(()=>{d.r(q),d.d(q,{PluginModule:()=>h,default:()=>Xe});var a=d(223),b=d(951),f=d(372),U=d(584),_=d(95),o=d(888);function p(t){return"function"==typeof t}function C(t){return e=>{if(function he(t){return p(t?.lift)}(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function j(...t){(0,_.wakoLog)("plugin.watchnow",t)}var F=d(832),k=d(748);const D=function ge(t){const n=t(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}(t=>function(n){t(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function K(t,e){if(t){const n=t.indexOf(e);0<=n&&t.splice(n,1)}}class y{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const s of n)s.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(p(r))try{r()}catch(s){e=s instanceof D?s.errors:[s]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const s of i)try{Q(s)}catch(c){e=e??[],c instanceof D?e=[...e,...c.errors]:e.push(c)}}if(e)throw new D(e)}}add(e){var n;if(e&&e!==this)if(this.closed)Q(e);else{if(e instanceof y){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}}_hasParent(e){const{_parentage:n}=this;return n===e||Array.isArray(n)&&n.includes(e)}_addParent(e){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e}_removeParent(e){const{_parentage:n}=this;n===e?this._parentage=null:Array.isArray(n)&&K(n,e)}remove(e){const{_finalizers:n}=this;n&&K(n,e),e instanceof y&&e._removeParent(this)}}function J(t){return t instanceof y||t&&"closed"in t&&p(t.remove)&&p(t.add)&&p(t.unsubscribe)}function Q(t){p(t)?t():t.unsubscribe()}y.EMPTY=(()=>{const t=new y;return t.closed=!0,t})();const w={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},B={setTimeout(t,e,...n){const{delegate:r}=B;return r?.setTimeout?r.setTimeout(t,e,...n):setTimeout(t,e,...n)},clearTimeout(t){const{delegate:e}=B;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function X(t){B.setTimeout(()=>{const{onUnhandledError:e}=w;if(!e)throw t;e(t)})}function Z(){}const we=R("C",void 0,void 0);function R(t,e,n){return{kind:t,value:e,error:n}}let v=null;class $ extends y{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,J(e)&&e.add(this)):this.destination=ke}static create(e,n,r){return new L(e,n,r)}next(e){this.isStopped?G(function xe(t){return R("N",t,void 0)}(e),this):this._next(e)}error(e){this.isStopped?G(function ve(t){return R("E",void 0,t)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?G(we,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Me=Function.prototype.bind;function z(t,e){return Me.call(t,e)}class Pe{constructor(e){this.partialObserver=e}next(e){const{partialObserver:n}=this;if(n.next)try{n.next(e)}catch(r){O(r)}}error(e){const{partialObserver:n}=this;if(n.error)try{n.error(e)}catch(r){O(r)}else O(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(n){O(n)}}}class L extends ${constructor(e,n,r){let i;if(super(),p(e)||!e)i={next:e??void 0,error:n??void 0,complete:r??void 0};else{let s;this&&w.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&z(e.next,s),error:e.error&&z(e.error,s),complete:e.complete&&z(e.complete,s)}):i=e}this.destination=new Pe(i)}}function O(t){w.useDeprecatedSynchronousErrorHandling?function Ee(t){w.useDeprecatedSynchronousErrorHandling&&v&&(v.errorThrown=!0,v.error=t)}(t):X(t)}function G(t,e){const{onStoppedNotification:n}=w;n&&B.setTimeout(()=>n(t,e))}const ke={closed:!0,next:Z,error:function Te(t){throw t},complete:Z},H="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ie(t){return t}let I=(()=>{class t{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new t;return r.source=this,r.operator=n,r}subscribe(n,r,i){const s=function Fe(t){return t&&t instanceof $||function Ce(t){return t&&p(t.next)&&p(t.error)&&p(t.complete)}(t)&&J(t)}(n)?n:new L(n,r,i);return function Se(t){if(w.useDeprecatedSynchronousErrorHandling){const e=!v;if(e&&(v={errorThrown:!1,error:null}),t(),e){const{errorThrown:n,error:r}=v;if(v=null,n)throw r}}else t()}(()=>{const{operator:c,source:u}=this;s.add(c?c.call(s,u):u?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=te(r))((i,s)=>{const c=new L({next:u=>{try{n(u)}catch(l){s(l),c.unsubscribe()}},error:s,complete:i});this.subscribe(c)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[H](){return this}pipe(...n){return function ee(t){return 0===t.length?Ie:1===t.length?t[0]:function(n){return t.reduce((r,i)=>i(r),n)}}(n)(this)}toPromise(n){return new(n=te(n))((r,i)=>{let s;this.subscribe(c=>s=c,c=>i(c),()=>r(s))})}}return t.create=e=>new t(e),t})();function te(t){var e;return null!==(e=t??w.Promise)&&void 0!==e?e:Promise}const Ue=function qe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function ne(t){if(t instanceof I)return t;if(null!=t){if(function Be(t){return p(t[H])}(t))return function $e(t){return new I(e=>{const n=t[H]();if(p(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if((t=>t&&"number"==typeof t.length&&"function"!=typeof t)(t))return function ze(t){return new I(e=>{for(let n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}(t);if(function ye(t){return p(t?.then)}(t))return function Le(t){return new I(e=>{t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,X)})}(t);if(function Oe(t){return Symbol.asyncIterator&&p(t?.[Symbol.asyncIterator])}(t))return re(t);if(function je(t){return p(t?.[Ue])}(t))return function Ge(t){return new I(e=>{for(const n of t)if(e.next(n),e.closed)return;e.complete()})}(t);if(function Re(t){return p(t?.getReader)}(t))return function He(t){return re(function De(t){return(0,k.__asyncGenerator)(this,arguments,function*(){const n=t.getReader();try{for(;;){const{value:r,done:i}=yield(0,k.__await)(n.read());if(i)return yield(0,k.__await)(void 0);yield yield(0,k.__await)(r)}}finally{n.releaseLock()}})}(t))}(t)}throw function Ae(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}(t)}function re(t){return new I(e=>{(function Ne(t,e){var n,r,i,s;return(0,k.__awaiter)(this,void 0,void 0,function*(){try{for(n=(0,k.__asyncValues)(t);!(r=yield n.next()).done;)if(e.next(r.value),e.closed)return}catch(c){i={error:c}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}e.complete()})})(t,e).catch(n=>e.error(n))})}function A(t,e,n,r,i){return new Ye(t,e,n,r,i)}class Ye extends ${constructor(e,n,r,i,s,c){super(e),this.onFinalize=s,this.shouldUnsubscribe=c,this._next=n?function(u){try{n(u)}catch(l){e.error(l)}}:super._next,this._error=i?function(u){try{i(u)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(u){e.error(u)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function oe(t){return C((e,n)=>{let s,r=null,i=!1;r=e.subscribe(A(n,void 0,void 0,c=>{s=ne(t(c,oe(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function N(t,e){return C((n,r)=>{let i=0;n.subscribe(A(r,s=>{r.next(t.call(e,s,i++))}))})}class x{getNameFromId(e){switch(e){case"apple_itunes":return"Itunes";case"google_play_movies":return"Google Play";case"netflix":return"Netflix";default:return e.replace(/_/gi," ")}}getNetflixUrl(e){return _.WakoHttpRequestService.request({url:e.url,method:"GET",responseType:"text"},"3d").pipe(oe(n=>302===n.status?(0,F.of)(n.response):(0,F.throwError)(n)),N(n=>{if(n.match("Found")&&null!==n.match(/href="([^"]*)/)){const c=n.match(/href="([^"]*)/);if(c[1])return c[1]}const s=(new DOMParser).parseFromString(n,"text/html").querySelector('meta[property="al:ios:url"]');return s&&s.getAttribute("content")?`http://www.netflix.com/watch/${s.getAttribute("content").split("/").pop().split("?").shift()}`:e.url}))}setKnownPlatformUrl(e){const n=[];return e.forEach(r=>{n.push("netflix"===r.id?this.getNetflixUrl(e[0]).pipe(N(i=>(r.url=i,r))):(0,F.of)(r))}),(0,F.forkJoin)(n)}getSources(e){let n=null;return e.movie?n=`/movies/${e.movie.ids.trakt}`:e.show&&e.episode&&(n=`/shows/${e.show.ids.trakt}/seasons/${e.episode.seasonNumber}/episodes/${e.episode.number}`),_.WakoHttpRequestService.get("https://trakt.tv"+n,null,"3d").pipe(N(r=>{const i=[];try{(new DOMParser).parseFromString(r,"text/html").querySelectorAll(".sources a").forEach(l=>{i.push({id:l.getAttribute("data-source").trim(),name:this.getNameFromId(l.getAttribute("data-source").trim()),country:l.getAttribute("data-country").trim(),url:"https://trakt.tv"+l.getAttribute("link").trim(),logoUrl:"https://trakt.tv"+l.querySelector("img").getAttribute("data-original")})})}catch{}return i}),function Ve(t,e){return C((n,r)=>{let i=null,s=0,c=!1;const u=()=>c&&!i&&r.complete();n.subscribe(A(r,l=>{i?.unsubscribe();let Y=0;const se=s++;ne(t(l,se)).subscribe(i=A(r,ce=>r.next(e?e(l,ce,se,Y++):ce),()=>{i=null,u()}))},()=>{c=!0,u()}))})}(r=>this.setKnownPlatformUrl(r)))}}function We(t,e){1&t&&o.\u0275\u0275element(0,"ion-spinner")}function Ke(t,e){1&t&&(o.\u0275\u0275elementStart(0,"ion-text"),o.\u0275\u0275text(1),o.\u0275\u0275pipe(2,"translate"),o.\u0275\u0275elementEnd()),2&t&&(o.\u0275\u0275advance(1),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(2,1,"noSourceFound")))}function Je(t,e){if(1&t){const n=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"ion-button",3),o.\u0275\u0275listener("click",function(){const s=o.\u0275\u0275restoreView(n).$implicit,c=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(c.goTo(s))}),o.\u0275\u0275text(1),o.\u0275\u0275pipe(2,"titlecase"),o.\u0275\u0275elementEnd()}if(2&t){const n=e.$implicit;o.\u0275\u0275classMap(n.id),o.\u0275\u0275advance(1),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(2,4,n.name)," ")}}x.\u0275fac=function(e){return new(e||x)},x.\u0275prov=o.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac});class g{constructor(e){this.watchnowService=e,this.type="button",this.sources=[],this.loading=!0}ngOnInit(){this.watchnowService.getSources({movie:this.movie,show:this.show,episode:this.episode}).pipe(function me(t){return C((e,n)=>{try{e.subscribe(n)}finally{n.add(t)}})}(()=>this.loading=!1)).subscribe(e=>{this.sources=e,console.log({sources:e})})}goTo(e){(function be(t,e){"FirebasePlugin"in window&&window.FirebasePlugin.logEvent(t,e)})("addon_watchnow",{type:this.type,source:e.id}),_.BrowserService.open(e.url,!1)}}g.\u0275fac=function(e){return new(e||g)(o.\u0275\u0275directiveInject(x))},g.\u0275cmp=o.\u0275\u0275defineComponent({type:g,selectors:[["wk-open-button"]],inputs:{movie:"movie",show:"show",episode:"episode",type:"type"},decls:4,vars:3,consts:[[1,"container"],[4,"ngIf"],["expand","block",3,"class","click",4,"ngFor","ngForOf"],["expand","block",3,"click"]],template:function(e,n){1&e&&(o.\u0275\u0275elementStart(0,"div",0),o.\u0275\u0275template(1,We,1,0,"ion-spinner",1),o.\u0275\u0275template(2,Ke,3,3,"ion-text",1),o.\u0275\u0275template(3,Je,3,6,"ion-button",2),o.\u0275\u0275elementEnd()),2&e&&(o.\u0275\u0275advance(1),o.\u0275\u0275property("ngIf",n.loading),o.\u0275\u0275advance(1),o.\u0275\u0275property("ngIf",!n.loading&&0===n.sources.length),o.\u0275\u0275advance(1),o.\u0275\u0275property("ngForOf",n.sources))},dependencies:[a.NgForOf,a.NgIf,f.IonButton,f.IonSpinner,f.IonText,a.TitleCasePipe,U.TranslatePipe],styles:[".container[_ngcontent-%COMP%]   .button.netflix[_ngcontent-%COMP%]{--background: #e50914}.container[_ngcontent-%COMP%]   .button.apple_itunes[_ngcontent-%COMP%]{--background: #999}.container[_ngcontent-%COMP%]   .button.google_play_movies[_ngcontent-%COMP%]{--background: #607d8b}"]});class S extends _.EpisodeDetailBaseComponent{setShowEpisode(e,n){this.show=e,this.episode=n}}S.\u0275fac=function(){let t;return function(n){return(t||(t=o.\u0275\u0275getInheritedFactory(S)))(n||S)}}(),S.\u0275cmp=o.\u0275\u0275defineComponent({type:S,selectors:[["ng-component"]],features:[o.\u0275\u0275InheritDefinitionFeature],decls:1,vars:2,consts:[[3,"show","episode"]],template:function(e,n){1&e&&o.\u0275\u0275element(0,"wk-open-button",0),2&e&&o.\u0275\u0275property("show",n.show)("episode",n.episode)},dependencies:[g]});class E extends _.MovieDetailBaseComponent{setMovie(e){this.movie=e}}function ie(t,e,n,r,i,s,c){try{var u=t[s](c),l=u.value}catch(Y){return void n(Y)}u.done?e(l):Promise.resolve(l).then(r,i)}E.\u0275fac=function(){let t;return function(n){return(t||(t=o.\u0275\u0275getInheritedFactory(E)))(n||E)}}(),E.\u0275cmp=o.\u0275\u0275defineComponent({type:E,selectors:[["ng-component"]],features:[o.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"movie"]],template:function(e,n){1&e&&o.\u0275\u0275element(0,"wk-open-button",0),2&e&&o.\u0275\u0275property("movie",n.movie)},dependencies:[g]});class M extends _.PluginBaseService{constructor(e){super(),this.translate=e}initialize(){j("plugin initialized")}afterInstall(){j("plugin installed")}afterUpdate(){j("plugin updated")}setTranslation(e,n){this.translate.setDefaultLang(e),this.translate.use(e),this.translate.setTranslation(e,n)}customAction(e,n){}beforeMovieMiddleware(e){throw new Error("Method not implemented.")}afterMovieMiddleware(e){throw new Error("Method not implemented.")}beforeShowMiddleware(e){throw new Error("Method not implemented.")}afterShowMiddleware(e){throw new Error("Method not implemented.")}beforeEpisodeMiddleware(e,n){throw new Error("Method not implemented.")}afterEpisodeMiddleware(e,n){throw new Error("Method not implemented.")}fetchExplorerFolderItem(){throw new Error("Method not implemented.")}getFileActionButtons(e,n,r,i,s,c){return function Qe(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function c(l){ie(s,r,i,c,u,"next",l)}function u(l){ie(s,r,i,c,u,"throw",l)}c(void 0)})}}(function*(){throw new Error("Method not implemented.")})()}}M.\u0275fac=function(e){return new(e||M)(o.\u0275\u0275inject(U.TranslateService))},M.\u0275prov=o.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac});class P extends _.ShowDetailBaseComponent{setShow(e){this.show=e}}P.\u0275fac=function(){let t;return function(n){return(t||(t=o.\u0275\u0275getInheritedFactory(P)))(n||P)}}(),P.\u0275cmp=o.\u0275\u0275defineComponent({type:P,selectors:[["ng-component"]],features:[o.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"show"]],template:function(e,n){1&e&&o.\u0275\u0275element(0,"wk-open-button",0),2&e&&o.\u0275\u0275property("show",n.show)},dependencies:[g]});class h extends _.PluginBaseModule{}h.pluginService=M,h.movieComponent=E,h.episodeComponent=S,h.showComponent=P,h.\u0275fac=function(){let t;return function(n){return(t||(t=o.\u0275\u0275getInheritedFactory(h)))(n||h)}}(),h.\u0275mod=o.\u0275\u0275defineNgModule({type:h}),h.\u0275inj=o.\u0275\u0275defineInjector({providers:[M,x],imports:[a.CommonModule,b.FormsModule,f.IonicModule.forRoot(),U.TranslateModule.forRoot()]});const Xe=h})(),q})());